<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹¼äººæ€æ¸¸æˆAIåˆ†ææŠ¥å‘Š</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0c1220 0%, #1a2439 50%, #0f172a 100%);
            color: #e2e8f0;
            overflow-x: hidden;
            min-height: 100vh;
            line-height: 1.6;
        }

        .header {
            background: rgba(15, 23, 42, 0.6);
            padding: 40px 0;
            text-align: center;
            border-bottom: 1px solid rgba(94, 234, 212, 0.15);
            backdrop-filter: blur(12px);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 30%, rgba(94, 234, 212, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(56, 189, 248, 0.1) 0%, transparent 40%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.8em;
            background: linear-gradient(90deg, #5eead4 0%, #38bdf8 50%, #818cf8 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }

        .header p {
            color: #94a3b8;
            font-size: 1.2em;
            position: relative;
            z-index: 2;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            padding: 0 10px;
        }

        .tab {
            padding: 14px 28px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #94a3b8;
            font-weight: 600;
            background: rgba(15, 23, 42, 0.4);
            border: 1px solid rgba(94, 234, 212, 0.1);
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(94, 234, 212, 0.2), transparent);
            transition: left 0.5s;
        }

        .tab:hover::before {
            left: 100%;
        }

        .tab:hover {
            color: #e2e8f0;
            border-color: rgba(94, 234, 212, 0.3);
            transform: translateY(-2px);
        }

        .tab.active {
            color: #5eead4;
            background: rgba(94, 234, 212, 0.1);
            border-color: rgba(94, 234, 212, 0.4);
            box-shadow: 0 4px 20px rgba(94, 234, 212, 0.15);
        }

        .content-area {
            background: rgba(30, 41, 59, 0.4);
            border-radius: 16px;
            padding: 40px;
            min-height: 600px;
            border: 1px solid rgba(94, 234, 212, 0.15);
            backdrop-filter: blur(8px);
            box-shadow: 0 8px 32px rgba(2, 8, 20, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(15, 23, 42, 0.5);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(94, 234, 212, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(94, 234, 212, 0.05) 0%, rgba(56, 189, 248, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
            border-color: rgba(94, 234, 212, 0.3);
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.95em;
            position: relative;
            z-index: 2;
        }

        .viz-container {
            width: 100%;
            height: 640px;
            position: relative;
            margin-bottom: 40px;
            background: rgba(15, 23, 42, 0.3);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(94, 234, 212, 0.1);
        }

        .player-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }

        .player-card {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid rgba(94, 234, 212, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(94, 234, 212, 0.05) 0%, rgba(56, 189, 248, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .player-card:hover::before {
            opacity: 1;
        }

        .player-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
            border-color: rgba(94, 234, 212, 0.25);
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .player-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #e2e8f0;
        }

        .player-role {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .role-werewolf {
            background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
        }

        .role-villager {
            background: linear-gradient(135deg, #60a5fa 0%, #93c5fd 100%);
        }

        .role-seer {
            background: linear-gradient(135deg, #a78bfa 0%, #c4b5fd 100%);
        }

        .role-witch {
            background: linear-gradient(135deg, #f472b6 0%, #f9a8d4 100%);
        }

        .role-hunter {
            background: linear-gradient(135deg, #f59e0b 0%, #fcd34d 100%);
        }

        .metrics {
            margin-top: 20px;
            position: relative;
            z-index: 2;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .metric-bar {
            width: 100%;
            height: 8px;
            background: rgba(148, 163, 184, 0.15);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 6px;
        }

        .metric-fill {
            height: 100%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(94, 234, 212, 0.3);
        }

        .analysis-text {
            margin-top: 20px;
            padding: 15px;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 8px;
            font-size: 0.85em;
            line-height: 1.6;
            color: #cbd5e1;
            border-left: 3px solid rgba(94, 234, 212, 0.3);
            position: relative;
            z-index: 2;
        }

        .click-hint {
            font-size: 0.75em;
            color: #5eead4;
            margin-top: 8px;
            opacity: 0.8;
            font-weight: 500;
            transition: opacity 0.3s ease;
        }

        .click-hint:hover {
            opacity: 1;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            margin: 5% auto;
            padding: 35px;
            border-radius: 16px;
            width: 80%;
            max-width: 650px;
            border: 1px solid rgba(94, 234, 212, 0.2);
            position: relative;
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-30px) scale(0.95);
                opacity: 0;
            }

            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .close {
            color: #94a3b8;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 25px;
            top: 20px;
            transition: color 0.3s ease;
            z-index: 10;
        }

        .close:hover {
            color: #e2e8f0;
        }

        .modal-title {
            color: #5eead4;
            font-size: 1.6em;
            margin-bottom: 20px;
            padding-right: 40px;
            font-weight: 600;
            background: linear-gradient(90deg, #5eead4 0%, #38bdf8 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .modal-body {
            line-height: 1.7;
            color: #cbd5e1;
            font-size: 1.05em;
        }

        .modal-highlight {
            background: rgba(94, 234, 212, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #5eead4;
        }

        .modal-highlight strong {
            color: #5eead4;
            display: block;
            margin-bottom: 8px;
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .header {
                padding: 30px 0;
            }

            .header h1 {
                font-size: 2em;
            }

            .tabs {
                gap: 10px;
            }

            .tab {
                padding: 12px 20px;
                font-size: 0.9em;
            }

            .content-area {
                padding: 25px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 15px;
            }

            .viz-container {
                height: 500px;
                padding: 15px;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 25px;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>ç‹¼äººæ€æ¸¸æˆAIåˆ†ææŠ¥å‘Š</h1>
        <p>åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„å¤šç»´è¡Œä¸ºåˆ†æç³»ç»Ÿ</p>
    </div>

    <div class="container">
        <div class="tabs">
            <div class="tab active" data-viz="psychology">å¿ƒç†ç”»åƒåˆ†æ</div>
            <div class="tab" data-viz="network">ç¤¾äº¤ç½‘ç»œå»ºæ¨¡</div>
        </div>

        <div class="content-area">
            <div class="stats-grid" id="statsGrid"></div>
            <div class="viz-container" id="vizContainer"></div>
            <div class="legend" id="legend"></div>
            <div class="player-cards" id="playerCards"></div>
        </div>
    </div>

    <div id="analysisModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-title" id="modalTitle"></div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // æ•°æ®ç»“æ„ä¿æŒä¸å˜
        const analysisData = {
            gameId: "20251221_114858",
            players: [
                { id: "Player1", name: "ç©å®¶1", role: "villager", isWerewolf: false },
                { id: "Player2", name: "ç©å®¶2", role: "witch", isWerewolf: false },
                { id: "Player3", name: "ç©å®¶3", role: "werewolf", isWerewolf: true },
                { id: "Player4", name: "ç©å®¶4", role: "hunter", isWerewolf: false },
                { id: "Player5", name: "ç©å®¶5", role: "werewolf", isWerewolf: true },
                { id: "Player6", name: "ç©å®¶6", role: "seer", isWerewolf: false },
                { id: "Player7", name: "ç©å®¶7", role: "werewolf", isWerewolf: true },
                { id: "Player8", name: "ç©å®¶8", role: "villager", isWerewolf: false },
                { id: "Player9", name: "ç©å®¶9", role: "villager", isWerewolf: false }
            ],
            analysisTexts: {
                stats: {
                    cognitiveConsistency: {
                        title: "è®¤çŸ¥ä¸€è‡´æ€§åˆ†æ",
                        content: "è®¤çŸ¥ä¸€è‡´æ€§åæ˜ ç©å®¶å†…å¿ƒç‹¬ç™½ä¸å…¬å¼€è¡Œä¸ºçš„åŒ¹é…ç¨‹åº¦ã€‚ç‹¼äººç©å®¶éœ€è¦ä¼ªè£…èº«ä»½ï¼Œå› æ­¤è¯¥å€¼æ™®éåä½ï¼ˆ<0.7ï¼‰ã€‚æœ¬å±€Player1å¾—åˆ†0.92ï¼Œæ˜¾ç¤ºæå¼ºçš„å†…åœ¨ä¸€è‡´æ€§ï¼Œç¬¦åˆå¥½äººç‰¹å¾ã€‚"
                    },
                    deceptionScore: {
                        title: "æ¬ºéª—æŒ‡æ•°åˆ†æ",
                        content: "åŸºäºè¯­è¨€æ¨¡å¼è¯†åˆ«çš„æ¬ºéª—æŒ‡æ•°ï¼Œé€šè¿‡åˆ†æå‘è¨€ä¸­çš„çŸ›ç›¾ç‚¹ã€è¿‡åº¦ä¿®é¥°å’Œæƒ…ç»ªæŠ‘åˆ¶ç­‰ç‰¹å¾è®¡ç®—ã€‚Player7å¾—åˆ†0.82ï¼Œå…¶ç‹¼äººèº«ä»½åœ¨å‘è¨€ä¸­è¡¨ç°å‡ºæ˜æ˜¾çš„é€»è¾‘çŸ›ç›¾ä¸æƒ…ç»ªæ§åˆ¶ã€‚"
                    },
                    strategyPurity: {
                        title: "ç­–ç•¥çº¯åº¦åˆ†æ",
                        content: "ç­–ç•¥çº¯åº¦è¡¡é‡ç©å®¶è¡Œä¸ºæ¨¡å¼çš„ä¸€è‡´æ€§ã€‚å¥½äººç©å®¶é€šå¸¸ä¿æŒç¨³å®šçš„ç­–ç•¥ï¼ˆ>0.7ï¼‰ï¼Œè€Œç‹¼äººå› éœ€ä¼ªè£…ï¼Œç­–ç•¥çº¯åº¦è¾ƒä½ã€‚Player3çš„0.42åˆ†æš´éœ²å…¶åå¤è°ƒæ•´ç­–ç•¥çš„å¼‚å¸¸è¡Œä¸ºã€‚"
                    },
                    stressResponse: {
                        title: "åº”æ¿€ååº”åˆ†æ",
                        content: "åº”æ¿€ååº”è¡¡é‡ç©å®¶åœ¨å‹åŠ›ä¸‹çš„è¡¨ç°ç¨³å®šæ€§ã€‚Player6åœ¨è¢«è´¨ç–‘æ—¶è¡¨ç°å‡ºä½åº”æ¿€ååº”ï¼ˆ0.35ï¼‰ï¼Œè¿™ä¸çœŸé¢„è¨€å®¶åº”æœ‰çš„åšå®šæ€åº¦ä¸ç¬¦ï¼Œåè€Œæš´éœ²äº†å…¶å†²åŠ¨å†³ç­–çš„å¼±ç‚¹ã€‚"
                    }
                },
                players: {
                    "Player6": {
                        title: "Player6ï¼ˆé¢„è¨€å®¶ï¼‰è¡Œä¸ºå‰–æ",
                        content: "Player6ä½œä¸ºçœŸé¢„è¨€å®¶é¦–å¤œæŸ¥éªŒPlayer7ä¸ºç‹¼äººï¼Œè¿™æœ¬åº”æ˜¯å…³é”®ä¿¡æ¯ã€‚ä½†å…¶è¿‡åº¦è‡ªä¿¡ï¼ˆ0.9ï¼‰å¯¼è‡´å†³ç­–å¤±è¯¯ï¼š1ï¼‰è¿‡æ—©æš´éœ²èº«ä»½ï¼Œæœªå»ºç«‹è¶³å¤Ÿä¿¡ä»»ï¼›2ï¼‰å‘è¨€è¿‡äºç»å¯¹ï¼Œä½¿ç”¨'å¿…é¡»''ç«‹å³'ç­‰è¯æ±‡ï¼Œè§¦å‘å¥½äººè­¦æƒ•ï¼›3ï¼‰æœªèƒ½æä¾›å¯éªŒè¯çš„åç»­è®¡åˆ’ã€‚æœ€ç»ˆè¢«å¥½äººé˜µè¥è¯¯æŠ•ï¼Œæ˜¯å…¸å‹çš„å¥½äººä¿¡æ¯ä¼˜åŠ¿è½¬åŒ–ä¸ºåŠ£åŠ¿æ¡ˆä¾‹ã€‚"
                    },
                    "Player7": {
                        title: "Player7ï¼ˆç‹¼äººï¼‰æ¬ºéª—ç­–ç•¥",
                        content: "Player7å±•ç°é«˜æ˜çš„æ¬ºéª—æŠ€å·§ï¼š1ï¼‰æ¬ºéª—æŒ‡æ•°0.82ï¼Œé€šè¿‡é€»è¾‘æ¸…æ™°çš„å‘è¨€æ©ç›–ç‹¼äººèº«ä»½ï¼›2ï¼‰åˆ©ç”¨'è™šå‡å…±è¯†'åå·®ï¼ˆ0.6ï¼‰ï¼Œé”™è¯¯ä¼°è®¡è¯´æœèƒ½åŠ›ï¼›3ï¼‰åœ¨è¢«æŒ‡æ§æ—¶å†·é™åå‡»ï¼Œå°†ç„¦ç‚¹è½¬ç§»è‡³Player6çš„è¡Œä¸ºæ¨¡å¼è€ŒéæŸ¥éªŒå†…å®¹ã€‚æˆåŠŸå¼•å¯¼å¥½äººè¯¯æŠ•çœŸé¢„è¨€å®¶ï¼Œæ˜¯ç‹¼äººé˜µè¥è·èƒœçš„å…³é”®ã€‚"
                    },
                    "Player2": {
                        title: "Player2ï¼ˆå¥³å·«ï¼‰æ²‰æ²¡æˆæœ¬é™·é˜±",
                        content: "Player2é¦–å¤œä½¿ç”¨è§£è¯æ•‘Player4åï¼Œé™·å…¥æ²‰æ²¡æˆæœ¬è°¬è¯¯ï¼ˆ0.8ï¼‰ã€‚å…¶åç»­å†³ç­–è¿‡åº¦ç»´æŠ¤é¦–å¤œåˆ¤æ–­ï¼Œå³ä½¿Player6çš„è¡Œä¸ºå¯ç–‘ï¼Œä¹Ÿå› ä¸æ„¿æ‰¿è®¤é¦–å¤œå¯èƒ½çŠ¯é”™è€Œæ”¯æŒæŠ•å‡ºPlayer6ã€‚è¿™ç§'ç»´æŠ¤å‰æœŸæŠ•å…¥'çš„å¿ƒç†å¯¼è‡´å¥½äººé˜µè¥å¤±å»çœŸé¢„è¨€å®¶ã€‚"
                    }
                },
                network: {
                    trustRelations: {
                        title: "ä¿¡ä»»ç½‘ç»œç»“æ„è§£è¯»",
                        content: "ç½‘ç»œä¸­ trust å…³ç³»ï¼ˆç»¿è‰²ï¼‰æ˜¾ç¤ºå¥½äººé˜µè¥çš„ä¿¡æ¯æµåŠ¨ã€‚Player2â†’Player4çš„ä¿¡ä»»æºäºé¦–å¤œæ•‘äººäº‹ä»¶ï¼Œè¿™ç§åŸºäºäº‹å®çš„ä¿¡ä»»è¾ƒä¸ºç¨³å›ºã€‚ç‹¼äººåŒç›Ÿï¼ˆæ©™è‰²ï¼‰å½¢æˆéšæ€§ä¸‰è§’ç»“æ„ï¼Œè™½æ— æ˜æ˜¾ä¿¡ä»»è¾¹ï¼Œä½†äº’ç›¸ä¸æ€€ç–‘çš„ç‰¹å¾æš´éœ²äº†é˜µè¥å…³ç³»ã€‚"
                    },
                    echoChamber: {
                        title: "å›å£°å®¤æ•ˆåº”æ£€æµ‹",
                        content: "æ£€æµ‹åˆ°2ä¸ªå›å£°å®¤ï¼š1ï¼‰Player1-Player3-Player5å½¢æˆå¯¹Player6çš„æ€€ç–‘åœˆï¼Œä¸‰äººäº’ç›¸å¼ºåŒ–'Player6å¯ç–‘'çš„è§‚ç‚¹ï¼›2ï¼‰ç‹¼äººå†…éƒ¨(Player3-Player7-Player5)å½¢æˆè§‚ç‚¹å…±æŒ¯ï¼ŒæŠ•ç¥¨è¡Œä¸ºé«˜åº¦åŒæ­¥ã€‚è¿™ç§å°é—­ä¿¡æ¯å¾ªç¯æ˜¯ç‹¼äººæ€ç¤¾äº¤ç½‘ç»œçš„å…¸å‹ç‰¹å¾ã€‚"
                    }
                }
            },
            psychology: {
                metrics: ["cognitiveConsistency", "stressResponse", "strategyPurity", "expressiveness", "deceptionScore"],
                players: {
                    "Player1": { cognitiveConsistency: 0.92, stressResponse: 0.78, strategyPurity: 0.88, expressiveness: 0.65, deceptionScore: 0.12 },
                    "Player2": { cognitiveConsistency: 0.85, stressResponse: 0.82, strategyPurity: 0.75, expressiveness: 0.72, deceptionScore: 0.23 },
                    "Player3": { cognitiveConsistency: 0.68, stressResponse: 0.55, strategyPurity: 0.42, expressiveness: 0.58, deceptionScore: 0.71 },
                    "Player4": { cognitiveConsistency: 0.88, stressResponse: 0.85, strategyPurity: 0.90, expressiveness: 0.70, deceptionScore: 0.15 },
                    "Player5": { cognitiveConsistency: 0.72, stressResponse: 0.60, strategyPurity: 0.48, expressiveness: 0.62, deceptionScore: 0.68 },
                    "Player6": { cognitiveConsistency: 0.45, stressResponse: 0.35, strategyPurity: 0.85, expressiveness: 0.88, deceptionScore: 0.25 },
                    "Player7": { cognitiveConsistency: 0.58, stressResponse: 0.70, strategyPurity: 0.52, expressiveness: 0.80, deceptionScore: 0.82 },
                    "Player8": { cognitiveConsistency: 0.78, stressResponse: 0.68, strategyPurity: 0.65, expressiveness: 0.55, deceptionScore: 0.28 },
                    "Player9": { cognitiveConsistency: 0.82, stressResponse: 0.72, strategyPurity: 0.70, expressiveness: 0.60, deceptionScore: 0.22 }
                }
            },
            network: {
                nodes: [
                    { id: "Player1", group: "villager", trust: 0.8 },
                    { id: "Player2", group: "witch", trust: 0.7 },
                    { id: "Player3", group: "werewolf", trust: 0.3 },
                    { id: "Player4", group: "hunter", trust: 0.85 },
                    { id: "Player5", group: "werewolf", trust: 0.35 },
                    { id: "Player6", group: "seer", trust: 0.6 },
                    { id: "Player7", group: "werewolf", trust: 0.4 },
                    { id: "Player8", group: "villager", trust: 0.75 },
                    { id: "Player9", group: "villager", trust: 0.78 }
                ],
                links: [
                    { source: "Player1", target: "Player3", value: -0.6, type: "suspect" },
                    { source: "Player1", target: "Player6", value: -0.7, type: "suspect" },
                    { source: "Player2", target: "Player6", value: -0.5, type: "suspect" },
                    { source: "Player2", target: "Player4", value: 0.8, type: "trust" },
                    { source: "Player3", target: "Player1", value: 0.5, type: "trust" },
                    { source: "Player3", target: "Player7", value: 0.7, type: "ally" },
                    { source: "Player5", target: "Player7", value: 0.8, type: "ally" },
                    { source: "Player5", target: "Player6", value: -0.6, type: "suspect" },
                    { source: "Player7", target: "Player6", value: -0.8, type: "suspect" },
                    { source: "Player7", target: "Player2", value: -0.4, type: "suspect" },
                    { source: "Player8", target: "Player6", value: -0.5, type: "suspect" },
                    { source: "Player9", target: "Player6", value: -0.4, type: "suspect" }
                ]
            }
        };

        let currentViz = 'psychology';
        const modal = document.getElementById('analysisModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const closeBtn = document.querySelector('.close');

        // æ·»åŠ å…¨å±€å›¾è¡¨å®ä¾‹å˜é‡
        let currentChart = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            initializeTabs();
            initializeModal();
            renderVisualization();
        });

        // Tabåˆ‡æ¢
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function () {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentViz = this.dataset.viz;
                    renderVisualization();
                });
            });
        }

        // æ¨¡æ€æ¡†æ§åˆ¶
        function initializeModal() {
            closeBtn.onclick = function () {
                modal.style.display = 'none';
            };

            window.onclick = function (event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            };
        }

        function showAnalysis(title, content) {
            modalTitle.textContent = title;
            modalBody.innerHTML = content;
            modal.style.display = 'block';
        }

        // ä¸»æ¸²æŸ“å‡½æ•°
        function renderVisualization() {
            // é”€æ¯ç°æœ‰å›¾è¡¨å®ä¾‹
            if (currentChart) {
                currentChart.dispose();
                currentChart = null;
            }

            // æ¸…ç©ºå®¹å™¨
            document.getElementById('vizContainer').innerHTML = '';
            document.getElementById('legend').innerHTML = '';
            document.getElementById('playerCards').innerHTML = '';

            switch (currentViz) {
                case 'psychology':
                    renderPsychology();
                    break;
                case 'network':
                    renderNetwork();
                    break;
            }
        }

        // å¿ƒç†ç”»åƒåˆ†æ
        function renderPsychology() {
            const playerMetrics = Object.values(analysisData.psychology.players);
            const avgConsistency = playerMetrics.length 
                ? (playerMetrics.reduce((sum, p) => sum + p.cognitiveConsistency, 0) / playerMetrics.length * 100).toFixed(0) + '%'
                : '0%';
            const maxDeception = playerMetrics.length
                ? (Math.max(...playerMetrics.map(p => p.deceptionScore)) * 100).toFixed(0) + '%'
                : '0%';
            const purityRange = playerMetrics.length
                ? ((Math.max(...playerMetrics.map(p => p.strategyPurity)) - Math.min(...playerMetrics.map(p => p.strategyPurity))) * 100).toFixed(0) + '%'
                : '0%';
            const stressAnomalies = playerMetrics.filter(p => p.stressResponse < 0.5).length + 'äºº';

            const stats = [
                {
                    key: "cognitiveConsistency",
                    label: 'å¹³å‡è®¤çŸ¥ä¸€è‡´æ€§',
                    value: avgConsistency,
                    color: '#5eead4'
                },
                {
                    key: "deceptionScore",
                    label: 'æœ€å¤§æ¬ºéª—æŒ‡æ•°',
                    value: maxDeception,
                    color: '#ef4444'
                },
                {
                    key: "strategyPurity",
                    label: 'ç­–ç•¥çº¯åº¦å·®å¼‚',
                    value: purityRange,
                    color: '#f59e0b'
                },
                {
                    key: "stressResponse",
                    label: 'åº”æ¿€ååº”å¼‚å¸¸',
                    value: stressAnomalies,
                    color: '#a78bfa'
                }
            ];

            document.getElementById('statsGrid').innerHTML = stats.map(stat => `
                <div class="stat-card" onclick="showAnalysis(analysisData.analysisTexts.stats['${stat.key}'].title, analysisData.analysisTexts.stats['${stat.key}'].content)">
                    <div class="stat-value" style="color: ${stat.color}">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                    <div class="click-hint">ç‚¹å‡»æŸ¥çœ‹AIåˆ†æ</div>
                </div>
            `).join('');

            const container = document.getElementById('vizContainer');
            const chart = echarts.init(container);
            currentChart = chart; // ä¿å­˜å®ä¾‹å¼•ç”¨

            const players = Object.keys(analysisData.psychology.players);
            const metrics = analysisData.psychology.metrics;

            const series = metrics.map((metric, index) => ({
                name: getMetricName(metric),
                type: 'radar',
                data: [{
                    value: players.map(p => analysisData.psychology.players[p][metric] * 100),
                    name: getMetricName(metric),
                    itemStyle: { color: getColor(index) },
                    areaStyle: { opacity: 0.3 }
                }]
            }));

            const option = {
                backgroundColor: 'transparent',
                title: {
                    text: 'ç©å®¶å¿ƒç†ç”»åƒé›·è¾¾å›¾',
                    textStyle: { color: '#e2e8f0', fontSize: 18 },
                    left: 'center'
                },
                legend: {
                    data: metrics.map(getMetricName),
                    bottom: 0,
                    textStyle: { color: '#94a3b8' }
                },
                radar: {
                    indicator: players.map(p => ({
                        name: p,
                        max: 100,
                        axisLabel: { color: '#94a3b8' }
                    })),
                    splitArea: {
                        areaStyle: {
                            color: ['rgba(94, 234, 212, 0.1)', 'rgba(94, 234, 212, 0.05)']
                        }
                    },
                    axisLine: { lineStyle: { color: 'rgba(148, 163, 184, 0.3)' } },
                    splitLine: { lineStyle: { color: 'rgba(148, 163, 184, 0.2)' } }
                },
                series: series,
                tooltip: {
                    backgroundColor: 'rgba(15, 23, 42, 0.9)',
                    borderColor: 'rgba(94, 234, 212, 0.3)',
                    textStyle: { color: '#e2e8f0' }
                }
            };

            chart.setOption(option);

            // å…³é”®ä¿®å¤ï¼šå»¶è¿Ÿresizeç¡®ä¿æ¸²æŸ“
            setTimeout(() => {
                chart.resize();
            }, 100);

            renderPlayerCards('psychology');
        }

        // ç¤¾äº¤ç½‘ç»œå»ºæ¨¡
        function renderNetwork() {
            const trustCount = analysisData.network.links.filter(l => l.type === 'trust').length;
            const suspectCount = analysisData.network.links.filter(l => l.type === 'suspect').length;
            const echoChamberCount = Array.isArray(analysisData.network.echoChambers)
                ? analysisData.network.echoChambers.length
                : (analysisData.network.echoChamberCount || 0);
            const avgTrust = analysisData.network.nodes.length
                ? (analysisData.network.nodes.reduce((sum, n) => sum + (n.trust || 0), 0) / analysisData.network.nodes.length)
                : 0;

            const stats = [
                { key: 'trustRelations', label: 'ä¿¡ä»»å…³ç³»æ•°', value: trustCount, color: '#5eead4' },
                { key: 'suspectRelations', label: 'æ€€ç–‘å…³ç³»æ•°', value: suspectCount, color: '#ef4444' },
                { key: 'echoChamber', label: 'å›å£°å®¤æ•°', value: echoChamberCount, color: '#f59e0b' },
                { key: 'avgTrust', label: 'å¹³å‡ä¿¡ä»»åº¦', value: avgTrust.toFixed(1), color: '#a78bfa' }
            ];

            document.getElementById('statsGrid').innerHTML = stats.map(stat => `
                <div class="stat-card" data-network-key="${stat.key}">
                    <div class="stat-value" style="color: ${stat.color}">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                    <div class="click-hint">ç‚¹å‡»æŸ¥çœ‹AIåˆ†æ</div>
                </div>
            `).join('');

            // ç»‘å®šç½‘ç»œç»Ÿè®¡å¡ç‰‡çš„ç‚¹å‡»äº‹ä»¶ï¼Œç¼ºå†…å®¹æ—¶ç»™å‡ºå…œåº•æç¤º
            document.querySelectorAll('.stat-card[data-network-key]').forEach(card => {
                const key = card.dataset.networkKey;
                const analysis = analysisData.analysisTexts?.network?.[key];
                const fallbackTitle = card.querySelector('.stat-label')?.textContent || 'AIåˆ†æ';
                const fallbackContent = 'æš‚æ— å¯ç”¨çš„AIåˆ†ææ–‡æœ¬ï¼Œç¨åå†è¯•ã€‚';

                card.addEventListener('click', () => {
                    showAnalysis(
                        analysis?.title || fallbackTitle,
                        analysis?.content || fallbackContent
                    );
                });
            });

            const container = document.getElementById('vizContainer');
            const width = container.offsetWidth;
            const height = 600;

            const svg = d3.select(container)
                .append('svg')
                .attr('class', 'network-svg')
                .attr('viewBox', `0 0 ${width} ${height}`);

            const simulation = d3.forceSimulation(analysisData.network.nodes)
                .force('link', d3.forceLink(analysisData.network.links).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(50));

            const link = svg.append('g')
                .selectAll('line')
                .data(analysisData.network.links)
                .enter().append('line')
                .attr('class', 'link')
                .attr('stroke', d => d.type === 'trust' ? '#5eead4' : d.type === 'ally' ? '#f59e0b' : '#ef4444')
                .attr('stroke-opacity', 0.6)
                .attr('stroke-width', d => Math.abs(d.value) * 3);

            const node = svg.append('g')
                .selectAll('g')
                .data(analysisData.network.nodes)
                .enter().append('g')
                .attr('class', 'node')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            node.append('circle')
                .attr('r', d => d.trust * 30 + 20)
                .attr('fill', d => getRoleColor(d.group))
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .style('cursor', 'pointer')
                .on('click', function (event, d) {
                    const player = analysisData.players.find(p => p.id === d.id);
                    const connections = analysisData.network.links.filter(l =>
                        l.source.id === d.id || l.target.id === d.id
                    );
                    const allies = connections.filter(c => c.type === 'ally').length;

                    const analysis = allies > 0
                        ? "ğŸº ç¤¾äº¤ç½‘ç»œå¼‚å¸¸ï¼šæ£€æµ‹åˆ°åŒç›Ÿå…³ç³»ï¼Œä¸ç‹¼äººé˜µè¥è¡Œä¸ºæ¨¡å¼å»åˆã€‚åœ¨çœŸå®å¯¹å±€ä¸­éœ€è­¦æƒ•å…¶éšæ€§ååŒã€‚"
                        : "ğŸ›¡ï¸ ç¤¾äº¤å…³ç³»æ¸…æ™°ï¼šä¿¡ä»»ä¸æ€€ç–‘å…³ç³»æ˜ç¡®ï¼Œç¬¦åˆå¥½äººé˜µè¥ä¿¡æ¯å…¬å¼€çš„ç‰¹å¾ã€‚";

                    showAnalysis(`${d.id}ï¼ˆ${getRoleName(player.role)}ï¼‰ç¤¾äº¤ç½‘ç»œåˆ†æ`, analysis);
                });

            node.append('text')
                .attr('dy', '.35em')
                .attr('text-anchor', 'middle')
                .text(d => d.id)
                .style('font-size', '12px')
                .style('fill', '#fff');

            node.append('title')
                .text(d => `${d.id}\nä¿¡ä»»åº¦: ${d.trust.toFixed(2)}`);

            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                node.attr('transform', d => `translate(${d.x},${d.y})`);
            });

            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }

            renderPlayerCards('network');
        }

        // æ¸²æŸ“ç©å®¶å¡ç‰‡
        function renderPlayerCards(vizType) {
            const container = document.getElementById('playerCards');

            if (vizType === 'psychology') {
                container.innerHTML = Object.keys(analysisData.psychology.players).map(playerId => {
                    const metrics = analysisData.psychology.players[playerId];
                    const player = analysisData.players.find(p => p.id === playerId);
                    const deception = metrics.deceptionScore > 0.6;
                    const analysis = deception
                        ? "âš ï¸ é«˜é£é™©ç©å®¶ï¼šæ¬ºéª—æŒ‡æ•°æ˜¾è‘—åé«˜ï¼Œå»ºè®®é‡ç‚¹è§‚å¯Ÿå…¶å‘è¨€é€»è¾‘çš„ä¸€è‡´æ€§ã€‚"
                        : "âœ… è¡Œä¸ºæ¨¡å¼ç¨³å®šï¼šè®¤çŸ¥ä¸€è‡´æ€§è‰¯å¥½ï¼Œåº”æ¿€ååº”æ­£å¸¸ï¼Œç¬¦åˆå¥½äººé˜µè¥ç‰¹å¾ã€‚";

                    return `
                        <div class="player-card" onclick="showAnalysis(analysisData.analysisTexts.players['${playerId}'] ? analysisData.analysisTexts.players['${playerId}'].title : '${playerId}è¡Œä¸ºåˆ†æ', analysisData.analysisTexts.players['${playerId}'] ? analysisData.analysisTexts.players['${playerId}'].content : '${analysis}')">
                            <div class="player-header">
                                <div class="player-name">${playerId}</div>
                                <div class="player-role role-${player.role}">${getRoleName(player.role)}</div>
                            </div>
                            <div class="metrics">
                                ${Object.entries(metrics).map(([key, value]) => `
                                    <div class="metric">
                                        <span>${getMetricName(key)}</span>
                                        <span style="color:${key === 'deceptionScore' && value > 0.6 ? '#ef4444' : '#5eead4'}; font-weight:600;">${(value * 100).toFixed(0)}%</span>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-fill" style="width: ${value * 100}%; background: ${getMetricColor(key)};"></div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="analysis-text">
                                ${analysis}
                            </div>
                            <div class="click-hint">ç‚¹å‡»æŸ¥çœ‹å®Œæ•´AIè§£è¯» â†’</div>
                        </div>
                    `;
                }).join('');
            } else if (vizType === 'network') {
                container.innerHTML = analysisData.network.nodes.map(node => {
                    const player = analysisData.players.find(p => p.id === node.id);
                    const connections = analysisData.network.links.filter(l =>
                        l.source.id === node.id || l.target.id === node.id
                    );
                    const allies = connections.filter(c => c.type === 'ally').length;
                    const trusts = connections.filter(c => c.type === 'trust').length;
                    const suspects = connections.filter(c => c.type === 'suspect').length;

                    // å»é‡çš„ä¸»è¦è¿æ¥å±•ç¤ºï¼Œé¿å…åŒä¸€ç©å®¶é‡å¤å‡ºç°
                    const seenPartners = new Set();
                    const partnerLabels = [];
                    connections.forEach(c => {
                        const other = c.source.id === node.id ? c.target.id : c.source.id;
                        if (seenPartners.has(other)) return;
                        seenPartners.add(other);
                        const tag = c.type === 'trust' ? 'ä¿¡ä»»' : c.type === 'ally' ? 'åŒç›Ÿ' : 'æ€€ç–‘';
                        partnerLabels.push(`${other}(${tag})`);
                    });
                    const topPartners = partnerLabels.slice(0, 4).join(' Â· ');

                    const highlight = allies > 0
                        ? 'ğŸº ç¤¾äº¤ç½‘ç»œå¼‚å¸¸ï¼šæ£€æµ‹åˆ°åŒç›Ÿ/ååŒè¡Œä¸ºï¼Œå¯èƒ½å­˜åœ¨é˜µè¥åä½œã€‚'
                        : 'ğŸ›¡ï¸ ç¤¾äº¤å…³ç³»æ¸…æ™°ï¼šä¿¡ä»»ä¸æ€€ç–‘åˆ†å¸ƒå‡è¡¡ã€‚';

                    const analysis = `${highlight}<br>è¿æ¥æ¦‚è§ˆï¼šä¿¡ä»»${trusts} Â· æ€€ç–‘${suspects} Â· åŒç›Ÿ${allies}${topPartners ? '<br>ä¸»è¦è¿æ¥ï¼š' + topPartners : ''}`;

                    return `
                        <div class="player-card" onclick="showAnalysis('${node.id}ï¼ˆ${getRoleName(player.role)}ï¼‰ç¤¾äº¤ç½‘ç»œåˆ†æ', '${analysis}')">
                            <div class="player-header">
                                <div class="player-name">${node.id}</div>
                                <div class="player-role role-${player.role}">${getRoleName(player.role)}</div>
                            </div>
                            <div class="metrics">
                                <div class="metric">
                                    <span>ä¿¡ä»»åº¦</span>
                                    <span style="color:#5eead4; font-weight:600;">${node.trust.toFixed(2)}</span>
                                </div>
                                <div class="metric-bar">
                                    <div class="metric-fill" style="width: ${node.trust * 100}%; background: #5eead4;"></div>
                                </div>
                                <div class="metric">
                                    <span>è¿æ¥æ•°</span>
                                    <span style="color:#38bdf8; font-weight:600;">${connections.length}</span>
                                </div>
                                <div style="font-size: 0.8em; margin-top: 10px; color: #94a3b8; line-height: 1.4;">
                                    ${topPartners || 'æš‚æ— æ›´å¤šè¿æ¥'}
                                </div>
                            </div>
                            <div class="analysis-text">
                                ${analysis}
                            </div>
                            <div class="click-hint">ç‚¹å‡»æŸ¥çœ‹ç½‘ç»œå®šä½åˆ†æ â†’</div>
                        </div>
                    `;
                }).join('');
            }
        }

        // å·¥å…·å‡½æ•°
        function getMetricName(key) {
            const names = {
                cognitiveConsistency: 'è®¤çŸ¥ä¸€è‡´æ€§',
                stressResponse: 'åº”æ¿€ååº”',
                strategyPurity: 'ç­–ç•¥çº¯åº¦',
                expressiveness: 'è¡¨è¾¾ä¸°å¯Œåº¦',
                deceptionScore: 'æ¬ºéª—æŒ‡æ•°'
            };
            return names[key] || key;
        }

        function getMetricColor(key) {
            const colors = {
                cognitiveConsistency: '#5eead4',
                stressResponse: '#38bdf8',
                strategyPurity: '#a78bfa',
                expressiveness: '#f472b6',
                deceptionScore: '#ef4444'
            };
            return colors[key] || '#94a3b8';
        }

        function getColor(index) {
            const colors = ['#5eead4', '#38bdf8', '#a78bfa', '#f472b6', '#f59e0b'];
            return colors[index % colors.length];
        }

        function getRoleColor(role) {
            const colors = {
                werewolf: '#ef4444',
                villager: '#60a5fa',
                seer: '#a78bfa',
                witch: '#f472b6',
                hunter: '#f59e0b'
            };
            return colors[role] || '#94a3b8';
        }

        function getRoleName(role) {
            const names = {
                werewolf: 'ç‹¼äºº',
                villager: 'æ‘æ°‘',
                seer: 'é¢„è¨€å®¶',
                witch: 'å¥³å·«',
                hunter: 'çŒäºº'
            };
            return names[role] || role;
        }
    </script>
</body>

</html>