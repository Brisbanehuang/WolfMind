# 🚀 快速开始指南

## 📋 前置要求

1. Python 3.8+
2. AgentScope 框架
3. DashScope API Key (或其他支持的 LLM API)

## 🔧 安装依赖

```bash
pip install -r requirements.txt
```

## ⚙️ 配置设置

### 1. 复制配置文件

```bash
# 复制示例配置文件
cp .env.example .env
```

### 2. 编辑 .env 文件

打开 `.env` 文件，填入你的配置：

```bash
# 选择模型提供商 (dashscope, openai, ollama)
MODEL_PROVIDER=dashscope

# 如果使用 DashScope
DASHSCOPE_API_KEY=your_dashscope_api_key_here

# 如果使用 OpenAI 兼容接口（如智谱AI）
# MODEL_PROVIDER=openai
# OPENAI_API_KEY=your_openai_api_key_here
# OPENAI_BASE_URL=https://open.bigmodel.cn/api/paas/v4/
# OPENAI_MODEL_NAME=glm-4.5-air

# 如果使用 Ollama 本地模型
# MODEL_PROVIDER=ollama
# OLLAMA_MODEL_NAME=qwen2.5:1.5b

# 游戏语言 (zh: 中文, en: 英文)
GAME_LANGUAGE=zh
```

### 3. 启动游戏

```bash
python main.py
```

程序会自动：
- ✅ 验证配置是否完整
- ✅ 显示当前配置信息
- ✅ 加载历史检查点（如果存在）
- ✅ 开始游戏

## 🧪 测试角色系统

```bash
python test_roles.py
```

## 📖 文档导航

### 新手必读
1. **README.md** - 项目总览
2. **快速开始.md** (本文件) - 快速上手
3. **项目运行流程.md** - 了解游戏流程

### 深入理解
4. **角色系统说明.md** - 角色系统设计
5. **重构对比.md** - 重构前后对比
6. **优化建议.md** - 后续优化方向

### 开发参考
7. **游戏目标.md** - 项目目标
8. **重构完成总结.md** - 重构总结

## 🎯 项目结构

```
werewolves/
├── main.py              # 入口文件
├── game.py              # 游戏主逻辑
├── roles.py             # 角色类 (核心重构)
├── utils.py             # 工具函数
├── structured_model.py  # 结构化输出模型
├── prompt.py            # 游戏提示词
├── test_roles.py        # 测试脚本
└── checkpoints/         # 游戏存档
```

## 🔍 核心概念

### 角色系统
每个身份都是一个独立的类：
- `Werewolf` - 狼人
- `Villager` - 村民
- `Seer` - 预言家
- `Witch` - 女巫
- `Hunter` - 猎人

### 角色创建
```python
from roles import RoleFactory

# 创建角色实例
werewolf = RoleFactory.create_role(agent, "werewolf")
seer = RoleFactory.create_role(agent, "seer")
```

### 角色行为
```python
# 夜晚行动
result = await role.night_action(game_state)

# 白天投票
vote_msg = await role.vote(prompt, alive_players)
```

## ⚙️ 配置选项

所有配置都在 `.env` 文件中管理，无需修改代码！

### 切换语言

```bash
# .env 文件
GAME_LANGUAGE=zh  # 中文
# 或
GAME_LANGUAGE=en  # 英文
```

### 切换模型

```bash
# .env 文件

# 使用 DashScope (阿里云通义千问)
MODEL_PROVIDER=dashscope
DASHSCOPE_API_KEY=your_key_here

# 使用 OpenAI 兼容接口（如智谱AI）
MODEL_PROVIDER=openai
OPENAI_API_KEY=your_key_here
OPENAI_BASE_URL=https://open.bigmodel.cn/api/paas/v4/
OPENAI_MODEL_NAME=glm-4.5-air

# 使用 Ollama 本地模型
MODEL_PROVIDER=ollama
OLLAMA_MODEL_NAME=qwen2.5:1.5b
```

### 调整游戏参数

```bash
# .env 文件
MAX_GAME_ROUND=30          # 最大游戏轮数
MAX_DISCUSSION_ROUND=3     # 每人最大讨论轮数
```

### 启用 AgentScope Studio

```bash
# .env 文件
ENABLE_STUDIO=true
STUDIO_URL=http://localhost:3001
STUDIO_PROJECT=werewolf_game
```

### 自定义检查点位置

```bash
# .env 文件
CHECKPOINT_DIR=./my_checkpoints
CHECKPOINT_ID=my_game_save
```

## 🎲 游戏流程

1. **初始化** - 创建 9 个智能体
2. **角色分配** - 随机分配角色
3. **游戏循环** (最多 30 轮)
   - 🌙 **夜晚阶段**
     - 狼人讨论并选择击杀目标
     - 女巫决定是否使用药水
     - 预言家查验一名玩家
     - 猎人可能触发技能
   - ☀️ **白天阶段**
     - 公布夜晚死亡信息
     - 所有玩家讨论
     - 投票淘汰一名玩家
     - 猎人可能触发技能
4. **胜利判定**
   - 狼人胜利：狼人数 × 2 ≥ 存活人数
   - 村民胜利：所有狼人被淘汰
5. **游戏结束** - 玩家反思

## 🐛 常见问题

### Q: 游戏卡住不动？
A: 检查 API Key 是否正确，网络是否正常。

### Q: 如何查看详细日志？
A: 在 `main.py` 中启用 AgentScope Studio：
```python
import agentscope
agentscope.init(
    studio_url="http://localhost:3001",
    project="werewolf_game",
)
```

### Q: 如何添加新角色？
A: 参考 `角色系统说明.md` 中的"添加新角色"章节。

### Q: 如何让智能体学习？
A: 游戏会自动保存检查点到 `checkpoints/` 目录，多次运行游戏即可。

## 🔗 相关资源

- [AgentScope 文档](https://doc.agentscope.io/)
- [Structured Output](https://doc.agentscope.io/tutorial/task_agent.html#structured-output)
- [MsgHub and Pipelines](https://doc.agentscope.io/tutorial/task_pipeline.html)

## 💡 提示

1. **首次运行** - 可能需要一些时间初始化模型
2. **多局游戏** - 连续运行可以让智能体学习
3. **观察日志** - 可以看到智能体的思考过程
4. **调整参数** - 尝试不同的模型和参数组合

## 🎉 开始游戏

现在你已经准备好了！运行 `python main.py` 开始你的狼人杀之旅吧！

祝游戏愉快！🐺⚔️👨‍🌾
